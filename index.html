<!DOCTYPE html>
<html>
<head>
<title>M3U8 Player</title>
<style>
body {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background-color: #f0f0f0;
}

#videoPlayer {
    background-color: #000; /* Black background for video area */
}
</style>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script> 
</head>
<body>

  <video id="videoPlayer" controls width="640" height="360"></video>

  <script>
    const videoPlayer = document.getElementById('videoPlayer');

    // Make an AJAX request to get the m3u8 URL
    const xhr = new XMLHttpRequest();
    xhr.open('GET', 'get_m3u8_url.php', true); // Same file for both HTML and PHP
    xhr.onload = function() {
      if (this.status >= 200 && this.status < 400) {
          const m3u8Url = this.responseText;


        if (Hls.isSupported()) {
          const hls = new Hls();
          hls.loadSource(m3u8Url);
          hls.attachMedia(videoPlayer);
          hls.on(Hls.Events.MANIFEST_PARSED, () => {
            videoPlayer.play(); 
          });
          hls.on(Hls.Events.ERROR, (event, data) => {
            console.error("HLS error:", data); 
            if (data.fatal) { // ... (Error handling as before) ...
              }
            });

        } else if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
          videoPlayer.src = m3u8Url;
          videoPlayer.addEventListener('loadedmetadata', () => {
            videoPlayer.play();
          });
        } else {
            // ... Error handling for HLS incompatibility as before...
        }


      } else {
        console.error('Error fetching m3u8 URL:', this.status, this.statusText);
      }
    };
    xhr.onerror = function() {
        console.error('Network error fetching m3u8 URL.');
    };


    xhr.send();



  </script>




<?php
// PHP code within the same file
if ($_SERVER['REQUEST_METHOD'] === 'GET' && isset($_GET['_']) && $_GET['_'] === "get_m3u8_url") { // Check if it's an AJAX call to get the URL

    $m3u8Url = "your_m3u8_url.m3u8";  // Replace with your actual URL or logic
    // Add security measures here (e.g., authentication)
    header('Content-Type: application/vnd.apple.mpegurl'); 
    echo $m3u8Url;
    exit; // Important: Stop further HTML output after sending the m3u8 URL
}

?>



</body>
</html>
